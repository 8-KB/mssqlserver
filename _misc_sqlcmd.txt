DBCC FREEPROCCACHE;
DBCC DROPCLEANBUFFERS;
DBCC FREESYSTEMCACHE ('ALL')

EXECUTE AS login='sa';

Get-ChildItem "C:\Program Files\Microsoft SQL Server" -Filter *.exe -Recurse | % { $_.FullName }
Get-ChildItem "C:\Program Files (x86)\Microsoft SQL Server" -Filter *.exe -Recurse | % { $_.FullName }
Get-WmiObject win32_service | select Name, DisplayName, State, PathName | Export-Csv -path "C:\services.csv"

fsutil fsinfo ntfsinfo d:\tempdb

/* Filestream BP*/
FSUTIL.EXE 8dot3name query F:
FSUTIL.EXE 8dot3name set F: 1 
fsutil.exe 8dot3name strip /s /v F:

netsh advfirewall firewall set rule group="windows management instrumentation (wmi)" new enable=yes

query session /server:SERVER_NAME
reset session [ID] /server: SERVER_NAME

netsh int tcp show global

Netsh int tcp set global chimney=disabled
Netsh int tcp set global netdma=disabled
netsh int ipv4 set global taskoffload=disabled

get-cluster | fl *subnet*
(get-cluster).SameSubnetDelay = 2000 
(get-cluster).SameSubnetThreshold = 10 

Get-ClusterResource "SQL Network Name (XXXXXXXXX)" | %{ $_.Name = “YYYYYYYYYYY” }

Get-ClusterResource 
Get-ClusterResource ag01 | Get-ClusterParameter
Get-ClusterResource ag01 | Set-ClusterParameter RegisterAllProvidersIP 0
Get-ClusterResource ag01 | Set-ClusterParameter HostRecordTTL 30

Get-ChildItem C:\WINDOWS\System32 -Filter *.txt -Recurse | % { $_.FullName }

/* Enable Trace Flags 1204 and 1222 at global level  */

DBCC TRACEON (1204,-1)
GO
DBCC TRACEON (1222,-1)
GO

/* Second Option Enabling Trace Flags 1204 and 1222 using DBCC TRACEON Statement at global level */

DBCC TRACEON (1204, 1222, -1);

/* Disable Trace Flags 1204 and 1222 at global level */

DBCC TRACEOFF (1204,-1);
DBCC TRACEOFF (1222,-1);

/* Second Option Disable Trace Flags 1204 and 1222 using single DBCC TRACEON Statement at global level */

DBCC TRACEOFF (1204, 1222, -1);

select max(last_batch),min(last_batch),DATEADD(HOUR, -5, GETDATE()),DATEADD(HOUR, 5, GETDATE())
 from sys.sysprocesses
where loginame='DOMAIN\XXXX'
and status ='sleeping' and last_batch < DATEADD(HOUR, -24, GETDATE())

SELECT 'KILL ' + cast(spid AS VARCHAR(max)) + ';'
	,*
FROM sys.sysprocesses
WHERE dbid IN (
		SELECT database_id
		FROM sys.databases
		WHERE name = 'DB_Name' --change
		)

-- Multi Value SP --
SELECT T.C.value('.', 'NVARCHAR(20)') AS [ID]
INTO #TempNHI
FROM (
	SELECT CAST('<ID>' + REPLACE(@Local_ID, ',', '</ID><ID>') + '</ID>' AS XML) AS [IDs]
	) AS A
CROSS APPLY IDs.nodes('/ID') AS T(C);

---- Stuck in Single User Mode ---- 


SET DEADLOCK_PRIORITY high;

ALTER DATABASE [DBATools]
SET OFFLINE;

ALTER DATABASE [DBATools]
SET MULTI_USER;

ALTER DATABASE [DBATools]
SET ONLINE;

